# Ralph Progress Log
# Branch: ralph/ecommerce-features
# Started: 2026-01-15

## Codebase Patterns
- Use runtime validation for env vars instead of `!` non-null assertions (ultracite forbids them)
- When creating Supabase clients, always check that NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY exist before using them
- ZodError uses `.issues` (not `.errors`) to access validation error messages

## 2026-01-15 - US-001
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Installed @supabase/supabase-js, @supabase/ssr, resend, zod, @tanstack/react-table
  - Created lib/supabase/server.ts with server-side client using cookies
  - Created lib/supabase/client.ts with browser-side client
  - Created lib/supabase/middleware.ts for middleware auth handling (updateSession function)
  - Created lib/supabase/admin.ts with isAdminEmail() function
- Files changed:
  - package.json, bun.lock
  - lib/supabase/server.ts (new)
  - lib/supabase/client.ts (new)
  - lib/supabase/middleware.ts (new)
  - lib/supabase/admin.ts (new)
- **Learnings for future iterations:**
  - ultracite/Biome forbids non-null assertions (`!`), use runtime checks with proper error throwing instead
  - The linter auto-formats code on commit via lefthook pre-commit hook
  - Server-side Supabase client uses cookies() from next/headers (must be awaited in Next.js 16)
---

## 2026-01-15 - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created lib/types/database.ts with TypeScript type definitions
    - OrderStatus enum type matching PostgreSQL OrderStatus
    - User, Item, Order, OrderItem interfaces matching database schema
    - CartItem (OrderItem with joined Item) and CartWithItems (Order with joined OrderItems) for cart views
    - PLAYER_INFO_REQUIRED_ITEMS constant = [1, 2, 10, 19]
    - requiresPlayerInfo() utility function
  - Created lib/utils/currency.ts with formatCents() function
    - Converts cents to USD formatted string using Intl.NumberFormat
- Files changed:
  - lib/types/database.ts (new)
  - lib/utils/currency.ts (new)
- **Learnings for future iterations:**
  - Types should match the database schema exactly including column names (camelCase for TypeScript)
  - Use `as const` for constant arrays to enable type narrowing
  - Intl.NumberFormat is the idiomatic way to format currency in JavaScript
---

## 2026-01-15 - US-003
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/login/page.tsx with login card containing email input
  - Created /components/auth/login-form.tsx as a client component
    - Email input with validation
    - Submit button calling supabase.auth.signInWithOtp()
    - Redirects to /auth/callback after magic link click
    - Success message: "Check your email for the magic link!"
    - Error display from Supabase
    - Loading state with animated spinner on button
- Files changed:
  - app/login/page.tsx (new)
  - components/auth/login-form.tsx (new)
- **Learnings for future iterations:**
  - SVG elements need aria-label and role="img" for accessibility (Biome lint rule: noSvgWithoutTitle)
  - Use window.location.origin for building redirect URLs in client components
  - Loading states should disable both input and button to prevent double submissions
---

## 2026-01-15 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/auth/callback/route.ts as a Next.js route handler
    - Exchanges code for session via supabase.auth.exchangeCodeForSession()
    - Checks if user exists in User table by supabaseId
    - Creates new User record if not exists (with supabaseId, email, isAdmin)
    - Updates isAdmin flag if user exists but admin status changed
    - Redirects to / on success or /login?error=... on failure
- Files changed:
  - app/auth/callback/route.ts (new)
- **Learnings for future iterations:**
  - Supabase error code PGRST116 means "No rows found" - use this to detect new users
  - When updating User records, always include updatedAt timestamp
  - Route handlers use NextRequest/NextResponse for request/response handling
---

## 2026-01-15 - US-005
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /middleware.ts with route protection:
    - Refreshes Supabase session on every request using getUser()
    - Protected routes (/cart, /checkout) redirect unauthenticated users to /login
    - Admin routes (/admin/*) redirect unauthenticated users to /login
    - Admin routes check isAdmin flag in User table, redirect non-admins to /
    - Public routes (/, /products, /login) remain accessible
    - Matcher excludes static files, images, and Next.js internals
- Files changed:
  - middleware.ts (new)
- **Learnings for future iterations:**
  - Next.js middleware runs on the edge runtime - use createServerClient directly
  - Middleware matcher uses regex to exclude static assets
  - For admin checks, must query User table with supabaseId from auth session
  - Use helper function for route prefix matching (e.g., /admin and /admin/*)
---

## 2026-01-15 - US-006
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/actions/auth.ts with signOut() server action
    - Uses "use server" directive for Next.js server actions
    - Calls supabase.auth.signOut() to clear the session
    - Redirects to /login after signing out
- Files changed:
  - app/actions/auth.ts (new)
- **Learnings for future iterations:**
  - Server actions need the "use server" directive at the top of the file
  - redirect() from next/navigation can be used directly in server actions
  - Server actions can return void when they redirect
---

## 2026-01-15 - US-007
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /components/layout/header.tsx as a server component
    - Shows "Raptors" logo linking to /
    - Shows "Products" navigation link to /products
    - Shows cart icon (ShoppingCart from lucide-react) linking to /cart
    - Badge displays total cart item quantity (hidden when cart empty)
    - Badge count fetched from Supabase by summing OrderItem quantities for user's OPEN order
  - Updated /app/layout.tsx to include Header component in all pages
    - Wrapped children in <main> element for proper semantic structure
    - Updated page metadata title to "Raptors Store"
- Files changed:
  - components/layout/header.tsx (new)
  - app/layout.tsx (modified)
- **Learnings for future iterations:**
  - Wrap Supabase calls in try/catch and return fallback values when env vars aren't configured
  - Server components can fetch data directly using async/await
  - When using reduce() with inferred types, explicit parameter typing may be needed (e.g., `(sum: number, item: { quantity: number })`)
  - The Badge component from shadcn/ui works well for notification counts
---

## 2026-01-15 - US-008
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/products/page.tsx as a server component
    - Fetches active items from Supabase ordered by number ascending
    - Page title set to 'Raptors Spring 2026 Collection'
    - Graceful fallback when Supabase is not configured
  - Created /components/products/product-grid.tsx
    - Responsive grid layout: 1 column mobile, 2 sm, 3 lg, 4 xl
    - Uses Next.js Image component with fill mode for optimized images
    - Shows empty state when no products available
    - Displays item name, price (formatted), and sizes
- Files changed:
  - app/products/page.tsx (new)
  - components/products/product-grid.tsx (new)
- **Learnings for future iterations:**
  - Must use Next.js Image component instead of <img> (Biome lint rule: noImgElement)
  - Image component with fill requires relative positioning on parent container
  - Use sizes prop on Image for responsive optimization
---

## 2026-01-15 - US-009
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /components/products/product-card.tsx as a client component
    - Shows item image (with Next.js Image), name, and price formatted as currency
    - Size dropdown using shadcn Select when item has sizes array
    - Player name/number inputs when item number is 1, 2, 10, or 19
    - Quantity input with min 1, max 99
    - Add to Cart button disabled until all required fields filled
    - Loading state using useTransition + Loader2 spinner
    - Form resets on successful add via resetForm function
  - Updated ProductGrid to use ProductCard component
- Files changed:
  - components/products/product-card.tsx (new)
  - components/products/product-grid.tsx (modified)
- **Learnings for future iterations:**
  - useTransition is ideal for async state management in client components
  - Pass optional callback props (like onAddToCart) for component flexibility
  - Use requiresPlayerInfo() from database types to check if item needs player info
---

## 2026-01-15 - US-010
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/actions/cart.ts with server actions for cart management
    - getOrCreateCart() - finds existing OPEN order or creates new one, returns CartWithItems
    - addToCart(formData) - validates input with zod, adds new OrderItem or increments existing
    - updateCartItem(formData) - updates quantity/size of existing cart item
    - removeFromCart(orderItemId) - deletes OrderItem from cart
    - recalculateOrderTotal() helper - sums line totals and updates order
  - All mutations call revalidatePath('/cart') and revalidatePath('/products')
  - All mutations return { success, error? } object
- Files changed:
  - app/actions/cart.ts (new)
- **Learnings for future iterations:**
  - When checking for existing items in cart, compare all attributes (itemId, size, playerName, playerNumber) not just itemId
  - Use zod coerce for form data values since they come as strings
  - Type assertions needed for Supabase joined queries (e.g., `orderItem.order as { userId: number; status: string }`)
  - getCurrentUserId() helper pattern is useful for getting database user ID from auth session
---

## 2026-01-15 - US-011
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/cart/page.tsx as a server component
    - Checks authentication and redirects to /login if not authenticated
    - Fetches cart via getOrCreateCart() and passes to CartView component
  - Created /components/cart/cart-view.tsx as a client component
    - Uses useOptimistic hook for instant UI updates on quantity changes and removal
    - Shows empty cart state with ShoppingBag icon and link to products
    - Displays list of cart items with: image, name, size, player info, unit price, quantity input, line total
    - Quantity changes update total immediately (optimistically)
    - Remove button (Trash2 icon) deletes item immediately (optimistically)
    - Order summary section shows subtotal and total
    - "Proceed to Checkout" button links to /checkout
- Files changed:
  - app/cart/page.tsx (new)
  - components/cart/cart-view.tsx (new)
- **Learnings for future iterations:**
  - useOptimistic is ideal for cart operations where immediate feedback improves UX
  - Define OptimisticAction type union for type-safe optimistic updates
  - Cart items integrated directly in CartView rather than separate CartItemRow component
  - Calculate totals from optimistic state, not from original cart prop
---

## 2026-01-15 - US-012
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /components/cart/cart-item-row.tsx as a client component
    - Shows item image (with Next.js Image), name, size, player info
    - Displays unit price (costCents) and line total (lineTotalCents)
    - Quantity input with onChange triggering onQuantityChange callback
    - Remove button (Trash2 icon) triggering onRemove callback
    - Disabled state (isPending prop) for both input and button
    - Loading spinner on remove button when pending
  - Updated /components/cart/cart-view.tsx to use CartItemRow component
    - Extracted inline cart item rendering to use the new component
    - Passes isPending, onQuantityChange, and onRemove as props
- Files changed:
  - components/cart/cart-item-row.tsx (new)
  - components/cart/cart-view.tsx (modified)
- **Learnings for future iterations:**
  - Extract reusable components with callback props for flexibility
  - Keep parent component in control of state management (isPending, handlers)
  - Linter (ultracite) removes unused imports, so add import + usage in same edit
---

## 2026-01-15 - US-013
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/checkout/page.tsx as a server component
    - Checks authentication and redirects to /login if not authenticated
    - Redirects to /cart if cart is empty
    - Displays order summary with item list, sizes, player info, quantities and totals
    - Uses two-column grid layout on larger screens
  - Created /components/checkout/checkout-form.tsx as a client component
    - Optional "Order Notes" textarea for special instructions
    - Submit button shows total amount (e.g., "Place Order - $123.45")
    - Loading state with spinner while processing (useTransition)
    - Form submission placeholder ready for US-014 submitOrder action
- Files changed:
  - app/checkout/page.tsx (new)
  - components/checkout/checkout-form.tsx (new)
- **Learnings for future iterations:**
  - Don't use async callbacks in startTransition without await (linter error)
  - Two-column grid (lg:grid-cols-2) works well for checkout layouts
  - Keep form action placeholder simple until actual action is implemented
---

## 2026-01-15 - US-014
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/actions/checkout.ts with submitOrder server action
    - Validates user authentication and retrieves user from database
    - Validates optional note input with zod
    - Updates order status from OPEN to PAID
    - Saves optional note to order
    - Sends HTML email to ADMIN_EMAIL via Resend library
    - Email includes: order ID, customer email, total, and table of line items with sizes/player info
    - Gracefully handles missing email config (logs error but doesn't fail order)
    - Redirects to /order-confirmation/[orderId] on success
    - Returns error if cart is empty
  - Updated /components/checkout/checkout-form.tsx to use submitOrder action
    - Replaced placeholder with actual async call to submitOrder
- Files changed:
  - app/actions/checkout.ts (new)
  - components/checkout/checkout-form.tsx (modified)
- **Learnings for future iterations:**
  - Use block statements (braces) for all if statements (linter requirement)
  - Email sending should be wrapped in try/catch to avoid failing the main operation
  - Use redirect() at the end of server actions for navigation after mutation
---

## 2026-01-15 - US-015
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/order-confirmation/[id]/page.tsx as a server component
    - Shows CheckCircle icon (lucide-react) and "Order Confirmed!" success message
    - Displays order number with # prefix and total formatted with formatCents()
    - Shows "Continue Shopping" button linking to /products
    - Returns 404 via notFound() if order ID is invalid or order not found
    - Uses Card components from shadcn/ui for clean presentation
- Files changed:
  - app/order-confirmation/[id]/page.tsx (new)
- **Learnings for future iterations:**
  - Dynamic route params in Next.js 16 are a Promise that must be awaited
  - Use Number.parseInt(id, 10) with Number.isNaN() check for validating numeric IDs
  - notFound() from next/navigation triggers the built-in 404 page
---

## 2026-01-15 - US-016
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Added shadcn table component via `bunx shadcn@latest add table`
  - Added shadcn checkbox component via `bunx shadcn@latest add checkbox`
  - Both components installed successfully to components/ui/
  - Ran `bun x ultracite fix` to auto-fix lint issues (import sorting, class sorting)
- Files changed:
  - components/ui/table.tsx (new)
  - components/ui/checkbox.tsx (new)
- **Learnings for future iterations:**
  - shadcn components need ultracite fix after installation (import sorting, class sorting)
  - Use `--yes` flag to skip prompts during component installation
---

## 2026-01-15 - US-017
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/admin/layout.tsx as a server component
    - Verifies user is authenticated via Supabase getUser()
    - Checks isAdmin flag in User table
    - Redirects non-admins to / and unauthenticated to /login
    - Shows sidebar with "Admin Dashboard" title
    - Displays user email at bottom of sidebar
  - Created /components/admin/admin-nav.tsx as a client component
    - Uses usePathname() for active link detection
    - Links to Items (/admin) and Orders (/admin/orders)
    - Active link highlighted with bg-muted styling
    - Uses lucide-react icons (Package, ShoppingBag)
  - Created placeholder /app/admin/page.tsx for Items route
- Files changed:
  - app/admin/layout.tsx (new)
  - app/admin/page.tsx (new)
  - components/admin/admin-nav.tsx (new)
- **Learnings for future iterations:**
  - Use optional chaining (?.) for null checks (linter prefers `!dbUser?.isAdmin` over `!(dbUser && dbUser.isAdmin)`)
  - Admin route detection: for /admin path, check exact match OR /admin/items prefix to avoid highlighting on /admin/orders
  - Sidebar layout pattern: flex with w-64 aside and flex-1 main content area
---

## 2026-01-15 - US-018
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /components/admin/data-table/data-table.tsx wrapping @tanstack/react-table
    - Accepts columns, data, filterColumn, filterPlaceholder, rowSelection, onRowSelectionChange, toolbar props
    - Supports column sorting via getSortedRowModel
    - Supports filtering via getFilteredRowModel with text input
    - Supports pagination via getPaginationRowModel
    - Supports row selection via onRowSelectionChange callback
  - Created /components/admin/data-table/data-table-pagination.tsx
    - Shows selected row count when rows selected
    - Shows current page / total pages
    - Navigation buttons: first, previous, next, last page
  - Created /components/admin/data-table/data-table-column-header.tsx
    - Sortable column header button with sort icons (up/down/unsorted)
    - Uses SortIcon helper to avoid nested ternary (linter rule)
- Files changed:
  - components/admin/data-table/data-table.tsx (new)
  - components/admin/data-table/data-table-pagination.tsx (new)
  - components/admin/data-table/data-table-column-header.tsx (new)
- **Learnings for future iterations:**
  - Biome/ultracite forbids nested ternary expressions - extract to helper functions with if/else
  - Biome/ultracite forbids barrel files (index.ts with re-exports) - import directly from component files
  - @tanstack/react-table generics pattern: DataTable<TData, TValue> where TData is row type, TValue is cell value type
---

## 2026-01-15 - US-019
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Updated /app/admin/page.tsx as a server component
    - Fetches all items from Supabase ordered by number ascending
    - Graceful fallback when Supabase is not configured
    - Renders ItemsDataTable with fetched items
  - Created /app/admin/items/columns.tsx with column definitions
    - Columns: number, name, price (formatted with formatCents), active (badge), sizes, actions
    - All columns sortable via DataTableColumnHeader
    - Actions dropdown with Edit and Delete options (Delete placeholder for US-021)
    - Uses Badge component for active/inactive status
  - Created /app/admin/items/items-data-table.tsx wrapping DataTable
    - Filter by item name
    - "New Item" button linking to /admin/items/new
- Files changed:
  - app/admin/page.tsx (modified)
  - app/admin/items/columns.tsx (new)
  - app/admin/items/items-data-table.tsx (new)
- **Learnings for future iterations:**
  - Import directly from component files, not via index barrels (e.g., `from "./columns"` not `from "./columns/index"`)
  - For action buttons with aria labels, use aria-label prop for accessibility
  - DropdownMenuItem with asChild + Link works well for navigation actions
---

## 2026-01-15 - US-020
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /components/admin/items/item-form.tsx as a client component
    - Fields: number (required), name (required), price in dollars (converted from cents), active toggle (Checkbox), sizes (comma-separated input), link (optional URL)
    - In edit mode, pre-fills with existing item values (converts costCents to dollars)
    - In create mode, fields are empty with active defaulting to true
    - Submit button shows "Create" or "Update" based on mode
    - Loading state with Loader2 spinner while submitting
    - Error display when submission fails
- Files changed:
  - components/admin/items/item-form.tsx (new)
- **Learnings for future iterations:**
  - Biome/ultracite forbids nested ternary - extract button text logic to helper function
  - Use onSubmit callback prop to allow parent to provide the server action
  - Checkbox component uses onCheckedChange with checked === true pattern
---

## 2026-01-15 - US-021
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/admin/items/actions.ts with server actions for item management
    - createItem(formData) - validates input with zod, converts price to cents, inserts new item
    - updateItem(id, formData) - validates and updates existing item, checks for duplicate item numbers
    - deleteItem(id) - deletes item, fails with helpful message if item has order items
    - All actions call revalidatePath('/admin')
    - All actions return { success, error? } object
  - Updated /app/admin/items/columns.tsx to use createColumns() factory function
    - Changed from static columns array to function that accepts onDelete callback
    - Allows delete functionality to work from parent component
  - Updated /app/admin/items/items-data-table.tsx to handle delete action
    - Uses useCallback + useMemo pattern for stable column references
    - Shows error messages when delete fails
    - Uses useTransition for pending state during delete
- Files changed:
  - app/admin/items/actions.ts (new)
  - app/admin/items/columns.tsx (modified)
  - app/admin/items/items-data-table.tsx (modified)
- **Learnings for future iterations:**
  - ZodError uses `.issues` not `.errors` to access validation error details
  - When passing callbacks to column definitions, use a factory function pattern (createColumns(onDelete))
  - For async handlers in useCallback, return a Promise and resolve inside startTransition
  - Use optional().transform() pattern for zod when the default should be applied after transformation
---

## 2026-01-15 - US-022
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/admin/items/new/page.tsx as a client component
    - Uses useRouter for programmatic navigation after successful creation
    - Renders ItemForm in create mode (no item prop)
    - Redirects to /admin on successful item creation
  - Created /app/admin/items/[itemId]/page.tsx as a server component
    - Fetches item from Supabase by id
    - Returns 404 (via notFound()) if item not found or invalid id
    - Uses Number.parseInt with Number.isNaN check for ID validation
  - Created /app/admin/items/[itemId]/edit-item-form.tsx as client component wrapper
    - Separates server-side data fetching from client-side form handling
    - Uses updateItem action bound to the current item ID
    - Redirects to /admin on successful update
- Files changed:
  - app/admin/items/new/page.tsx (new)
  - app/admin/items/[itemId]/page.tsx (new)
  - app/admin/items/[itemId]/edit-item-form.tsx (new)
- **Learnings for future iterations:**
  - When combining server components (for data fetching) with client components (for forms), create a client wrapper component
  - Dynamic route params in Next.js 16 are a Promise that must be awaited
  - Use Number.parseInt(id, 10) with Number.isNaN() for safe ID parsing
---

## 2026-01-15 - US-023
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/admin/orders/page.tsx as a server component
    - Fetches orders with user email via Supabase join (User!Order_userId_fkey)
    - Ordered by createdAt desc
    - Transforms data to include userEmail at top level for DataTable
  - Created /app/admin/orders/columns.tsx with column definitions
    - Columns: select (checkbox), ID (mono font with #), customer email, status (inline select), total (formatted), date, actions
    - Uses factory pattern createColumns(onStatusChange) for status update callback
    - Select column with select-all checkbox in header and individual row checkboxes
    - Actions dropdown with "View Details" linking to /admin/orders/[orderId]
  - Created /components/admin/orders/order-status-select.tsx
    - Dropdown with all order status options (OPEN, PAID, ORDERED, RECEIVED)
    - Badge colors: OPEN=secondary, PAID=default, ORDERED=outline, RECEIVED=secondary
    - Exports ORDER_STATUSES constant for use in filters
  - Created /app/admin/orders/orders-data-table.tsx wrapping DataTable
    - Status filter dropdown in toolbar (All Statuses + each status)
    - Filter by customer email text input
    - Row selection state management (for future bulk update - US-024)
    - Placeholder for status change handler (to be implemented in US-025)
- Files changed:
  - app/admin/orders/page.tsx (new)
  - app/admin/orders/columns.tsx (new)
  - app/admin/orders/orders-data-table.tsx (new)
  - components/admin/orders/order-status-select.tsx (new)
- **Learnings for future iterations:**
  - Use type assertion `as OrderFromDb[]` for Supabase joined query results to avoid implicit any
  - For unused variables required by structure (like isPending from useTransition), use `[, startTransition]` destructuring pattern
  - Biome/ultracite considers `_error` as unused if renamed but still referenced - remove completely or use consistently
  - Status badge variant logic should be extracted to a helper function to avoid duplication between select and column display
---

## 2026-01-15 - US-024
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Added shadcn dialog component via `bunx shadcn@latest add dialog`
  - Created /components/admin/orders/bulk-status-update-dialog.tsx
    - Shows count of selected orders in description
    - Status dropdown with all order status options (OPEN, PAID, ORDERED, RECEIVED)
    - Badge styling consistent with order-status-select component
    - Loading state with spinner while updating
    - Cancel and Update Status buttons in dialog footer
  - Updated /app/admin/orders/orders-data-table.tsx
    - Added "Update Status (N)" button in toolbar when rows selected
    - Tracks selected order IDs from row selection state
    - Wired up dialog to open on button click
    - Placeholder handler for bulk update (to be implemented in US-025)
    - Clears row selection after successful bulk update
- Files changed:
  - components/ui/dialog.tsx (new via shadcn)
  - components/admin/orders/bulk-status-update-dialog.tsx (new)
  - app/admin/orders/orders-data-table.tsx (modified)
- **Learnings for future iterations:**
  - Biome/ultracite forbids async functions without await - use `return Promise.resolve()` for placeholder promises
  - Select-all and individual row checkboxes were already implemented in columns.tsx from US-023
  - Use `Record<string, boolean>` type for rowSelection state instead of empty object type
  - Get selected row IDs by filtering rowSelection entries and mapping to filteredOrders by index
---

## 2026-01-15 - US-025
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/admin/orders/actions.ts with server actions
    - updateOrderStatus(orderId, status) - updates single order status and updatedAt
    - bulkUpdateOrderStatus(orderIds, status) - updates multiple orders at once
    - Both use zod schema for status validation
    - Both call revalidatePath('/admin/orders')
    - Both return { success, error? } object
  - Updated /app/admin/orders/orders-data-table.tsx
    - Wired handleStatusChange to call updateOrderStatus
    - Wired handleBulkStatusChange to call bulkUpdateOrderStatus
    - Removed placeholder TODOs
- Files changed:
  - app/admin/orders/actions.ts (new)
  - app/admin/orders/orders-data-table.tsx (modified)
- **Learnings for future iterations:**
  - Define memoized values (filteredOrders) before callbacks that depend on them
  - Use zod enum schema for type-safe status validation
  - Supabase .in() method updates multiple rows matching IDs
---

## 2026-01-15 - US-026
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created /app/admin/orders/[orderId]/page.tsx as a server component
    - Fetches order with user email and orderItems (including item details) via Supabase join
    - Returns 404 via notFound() if order ID is invalid or not found
    - Uses two-column grid layout on larger screens
  - Created /components/admin/orders/order-detail-card.tsx as a client component
    - Shows order ID, status (with inline OrderStatusSelect for updates), dates
    - Shows customer email
    - Shows order note if present (in separate bordered section)
    - Uses useTransition for async status updates
  - Created /components/admin/orders/order-items-table.tsx
    - Lists line items with: item name, size, player name/number, quantity, line total
    - Uses shadcn Table components for consistent styling
    - Shows order total in CardFooter
- Files changed:
  - app/admin/orders/[orderId]/page.tsx (new)
  - components/admin/orders/order-detail-card.tsx (new)
  - components/admin/orders/order-items-table.tsx (new)
- **Learnings for future iterations:**
  - Supabase nested joins work with `orderItems:OrderItem (item:Item (id, name, costCents))` syntax
  - Use `as unknown as Type` pattern for complex Supabase query results to avoid type inference issues
  - formatDate helper extracts date formatting logic to keep components clean
---

