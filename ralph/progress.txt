# Ralph Progress Log
Started: Thu Jan 15 18:12:17 CST 2026
---

## Codebase Patterns
- Use quoted column names for camelCase (e.g., "firstName", "createdAt")
- Table names are quoted and PascalCase (e.g., "Player", "User")
- Use `IF NOT EXISTS` for migrations to ensure idempotency
- UUID primary keys use `gen_random_uuid()` for defaults
- Always add useful indexes for common query patterns
- Junction tables use `ON DELETE CASCADE` for both foreign keys
- User.id is INTEGER (SERIAL), Player.id is UUID - match types in foreign keys
- Zod v4: access validation errors via `parsed.error.issues[0]`, not `.errors`
- Supabase join syntax for relations: `player:Player(*)` for junction tables

---

## 2026-01-15 18:12 - US-001
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Created Player table migration with UUID primary key
- Files changed: supabase/migrations/20260115181252_create_player_table.sql
- **Learnings for future iterations:**
  - Follow existing naming conventions: quoted PascalCase tables, quoted camelCase columns
  - Use `IF NOT EXISTS` for safer migrations
  - Add indexes for columns used in ORDER BY and WHERE clauses
---

## 2026-01-15 18:14 - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Created UserPlayer junction table migration with composite primary key
- Files changed: supabase/migrations/20260115181431_create_user_player_table.sql
- **Learnings for future iterations:**
  - User table uses SERIAL (integer) for id, Player uses UUID - junction tables must match these types
  - Use `ON DELETE CASCADE` for junction tables so deleting a user/player automatically removes the link
  - Composite primary key syntax: `PRIMARY KEY ("column1", "column2")`
---

## 2026-01-15 18:20 - US-003
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Added Player and UserPlayer TypeScript interfaces to lib/types/database.ts
- Files changed: lib/types/database.ts
- **Learnings for future iterations:**
  - Player.id is string (UUID), UserPlayer.playerId is string to match
  - User.id is number (INTEGER), UserPlayer.userId is number to match
  - Follow existing interface patterns in database.ts (JSDoc comments, consistent field naming)
---

## 2026-01-15 18:30 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Created player server actions file with 'use server' directive
- Implemented getPlayers(), createPlayer(), linkPlayerToUser(), getUserPlayers()
- Files changed: app/actions/players.ts
- **Learnings for future iterations:**
  - Zod errors are accessed via `.issues` not `.errors` in zod v4
  - Use generic ActionResult<T> type for actions that return data
  - Follow existing patterns in cart.ts for getCurrentUserId() helper
  - Use Supabase join syntax `player:Player(*)` for junction table queries
  - Add explicit types to filter callbacks to satisfy noImplicitAny
---

## 2026-01-15 18:45 - US-005
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Created player selection page server component at app/onboarding/player/page.tsx
- Implemented auth check with redirect to /login if not authenticated
- Implemented linked players check with redirect to / if user already has players
- Fetches all players via getPlayers() and prepares for client component integration
- Page title set to "Select Your Player"
- Files changed: app/onboarding/player/page.tsx, ralph/prd.json
- **Learnings for future iterations:**
  - Follow checkout/page.tsx pattern for auth checks: supabase.auth.getUser() â†’ redirect("/login")
  - getUserPlayers() returns ActionResult with optional data array - check for length > 0
  - Placeholder div for client component that will be integrated in US-006
---
