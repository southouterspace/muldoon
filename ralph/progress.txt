# Ralph Progress Log
# Branch: ralph/item-image-upload
# Started: 2026-01-15

## Codebase Patterns
- Use runtime validation for env vars instead of `!` non-null assertions (ultracite forbids them)
- When creating Supabase clients, always check that NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY exist before using them
- ZodError uses `.issues` (not `.errors`) to access validation error messages
- Server-side Supabase client uses cookies() from next/headers (must be awaited in Next.js 16)
- Biome/ultracite forbids nested ternary expressions - extract to helper functions with if/else
- Dynamic route params in Next.js 16 are a Promise that must be awaited
- Use Number.parseInt(id, 10) with Number.isNaN() for safe ID parsing
- The Item type already has `imageStoragePath: string | null` and `imageUrl: string | null` fields

---

## 2026-01-15 - US-001
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented:
  - Created SQL migration for 'product-images' Supabase Storage bucket
  - Configured bucket with public read access (public: true)
  - Added policies for public SELECT, authenticated INSERT, UPDATE, DELETE
- Files changed:
  - supabase/migrations/20260115184437_create_product_images_bucket.sql (new)
- **Learnings for future iterations:**
  - Supabase Storage buckets are created via INSERT INTO storage.buckets
  - Policies use storage.objects table with bucket_id condition
  - auth.role() = 'authenticated' checks for logged-in users in policies
---

